<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>La composition chimique des aliments ‚Äî Quiz</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { box-sizing: border-box; }

    .question-slide { opacity: 0; transform: translateX(50px); transition: all 0.6s cubic-bezier(0.4,0,0.2,1); }
    .question-slide.active { opacity: 1; transform: translateX(0); }

    .option-btn { transition: all 0.3s cubic-bezier(0.4,0,0.2,1); position: relative; overflow: hidden; }
    .option-btn::before { content: ""; position: absolute; top:0; left:-100%; width:100%; height:100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); transition: left 0.5s; }
    .option-btn:hover::before { left: 100%; }
    .option-btn:hover { transform: translateY(-2px) scale(1.02); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }

    .option-btn.correct { background: linear-gradient(135deg, #10b981, #059669); color:#fff; border-color:#059669; animation: correctPulse 0.6s ease-in-out; }
    .option-btn.incorrect { background: linear-gradient(135deg, #ef4444, #dc2626); color:#fff; border-color:#dc2626; animation: shake 0.5s ease-in-out; }

    .progress-bar { transition: width 0.8s cubic-bezier(0.4,0,0.2,1); }
    .celebration { animation: celebration 1s ease-in-out; }

    .floating-particles { position:absolute; width:100%; height:100%; pointer-events:none; overflow:hidden; }
    .particle { position:absolute; width:6px; height:6px; background: linear-gradient(45deg, #60a5fa, #a78bfa); border-radius:50%; animation: float 3s infinite ease-in-out; opacity:0.6; }

    @keyframes correctPulse { 0%{transform:scale(1)} 50%{transform:scale(1.05)} 100%{transform:scale(1)} }
    @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-5px)} 75%{transform:translateX(5px)} }
    @keyframes celebration { 0%,100%{transform:scale(1) rotate(0deg)} 25%{transform:scale(1.1) rotate(-5deg)} 50%{transform:scale(1.2) rotate(0)} 75%{transform:scale(1.1) rotate(5deg)} }
    @keyframes float { 0%,100%{transform:translateY(0) rotate(0); opacity:0} 50%{transform:translateY(-20px) rotate(180deg); opacity:1} }

    .glass-effect { backdrop-filter: blur(10px); background: rgba(255,255,255,0.8); border:1px solid rgba(255,255,255,0.9); box-shadow: 0 8px 32px rgba(31,38,135,0.15); }

    .next-btn { background: linear-gradient(135deg,#3b82f6 0%, #8b5cf6 100%); transition: all 0.3s ease; }
    .next-btn:hover { transform: translateY(-2px); box-shadow:0 10px 20px rgba(59,130,246,0.4); }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-100 relative overflow-y-auto">
  <!-- D√©cor anim√© discret -->
  <div class="floating-particles">
    <div class="particle" style="left:10%; animation-delay:0s;"></div>
    <div class="particle" style="left:20%; animation-delay:0.5s;"></div>
    <div class="particle" style="left:30%; animation-delay:1s;"></div>
    <div class="particle" style="left:40%; animation-delay:1.5s;"></div>
    <div class="particle" style="left:50%; animation-delay:2s;"></div>
    <div class="particle" style="left:60%; animation-delay:2.5s;"></div>
    <div class="particle" style="left:70%; animation-delay:3s;"></div>
    <div class="particle" style="left:80%; animation-delay:3.5s;"></div>
    <div class="particle" style="left:90%; animation-delay:4s;"></div>
  </div>

  <div class="container mx-auto px-4 py-8 pb-10 max-w-4xl relative z-10">
    <!-- En-t√™te -->
    <div class="text-center mb-8">
      <div class="glass-effect rounded-3xl p-8 mb-6">
        <h1 class="text-5xl font-bold text-gray-800 mb-4 drop-shadow-sm">üß™ La composition chimique des aliments</h1>
        <p class="text-xl text-gray-700">Testez vos connaissances sur les tests de reconnaissance des nutriments</p>
      </div>
    </div>

    <!-- Barre de progression et score -->
    <div class="glass-effect rounded-2xl p-6 mb-8">
      <div class="flex justify-between items-center mb-4">
        <div class="flex items-center">
          <span class="text-gray-800 font-semibold mr-4">Question <span id="current-question">1</span> sur <span id="total-questions">10</span></span>
        </div>
        <div class="flex items-center bg-blue-100 rounded-full px-4 py-2">
          <span class="text-2xl mr-2">üèÜ</span>
          <span class="text-xl font-bold text-gray-800">Score: <span id="score">0</span>/<span id="score-total">10</span></span>
        </div>
      </div>
      <div class="w-full bg-gray-200 rounded-full h-4">
        <div class="progress-bar bg-gradient-to-r from-blue-500 to-purple-600 h-4 rounded-full" id="progress-bar" style="width: 10%"></div>
      </div>
    </div>

    <!-- Conteneur question -->
    <div id="question-container" class="question-slide active"></div>

    <!-- Navigation -->
    <div id="navigation" class="text-center mt-8">
      <div class="flex justify-center gap-4">
        <button id="prev-btn" disabled class="bg-gradient-to-r from-gray-400 to-gray-500 text-white px-6 py-3 rounded-2xl font-bold text-lg shadow-2xl transition-all duration-300 hover:from-gray-500 hover:to-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">‚Üê Pr√©c√©dent</button>
        <button id="next-btn" class="next-btn text-white px-6 py-3 rounded-2xl font-bold text-lg shadow-2xl">Suivant ‚Üí</button>
      </div>
      <p class="mt-3 text-xs text-gray-600 text-center">Astuce : utilisez les fl√®ches du clavier ‚Üê ‚Üí pour naviguer.</p>
    </div>

    <!-- R√©sultats finaux -->
    <div id="final-results" class="hidden text-center mt-8">
      <div class="glass-effect rounded-3xl p-12 celebration">
        <h2 class="text-4xl font-bold text-gray-800 mb-6">üéâ Quiz termin√© !</h2>
        <div class="text-8xl mb-6" id="final-emoji">üéä</div>
        <p class="text-2xl text-gray-700 mb-8" id="final-message"></p>
        <button id="reset-btn" class="next-btn text-white px-10 py-4 rounded-2xl font-bold text-xl shadow-2xl">üîÑ Recommencer le quiz</button>
      </div>
    </div>
  </div>

  <script>
    // === Donn√©es d'origine ===
    const originalQuestions = [
      { question: "Comment met-on en √©vidence l'amidon dans le pain ?", options: [ "En ajoutant de l'oxalate d'ammonium au filtrat de pain.", "En versant de l'acide nitrique sur un morceau de pain.", "En d√©posant de l'eau iod√©e sur un morceau de pain." ], correct: 2 },
      { question: "Comment met-on en √©vidence les protides dans le pain ?", options: [ "En versant de l'acide nitrique sur un morceau de pain.", "En ajoutant de l'eau iod√©e au filtrat de pain.", "En testant le filtrat de pain avec la liqueur de Fehling √† chaud." ], correct: 0 },
      { question: "Quelle est l'√©tape suivante apr√®s avoir broy√© du pain dans de l'eau distill√©e ?", options: [ "On verse de l'acide nitrique sur la bouillie.", "On filtre la bouillie et on r√©cup√®re le filtrat.", "On ajoute de l'oxalate d'ammonium √† la bouillie." ], correct: 1 },
      { question: "Comment met-on en √©vidence la pr√©sence de calcium dans le filtrat de pain ?", options: [ "En ajoutant quelques gouttes de nitrate d'argent.", "En testant le filtrat avec la liqueur de Fehling √† chaud.", "En ajoutant de l'oxalate d'ammonium au filtrat." ], correct: 2 },
      { question: "Comment met-on en √©vidence la pr√©sence de chlorures dans le filtrat de pain ?", options: [ "En ajoutant de l'acide nitrique.", "En versant de l'eau iod√©e.", "En ajoutant quelques gouttes de nitrate d'argent." ], correct: 2 },
      { question: "Comment met-on en √©vidence les sucres r√©ducteurs dans le filtrat de pain ?", options: [ "En testant le filtrat avec la liqueur de Fehling √† chaud.", "En ajoutant de l'acide nitrique.", "En versant de l'eau iod√©e sur le filtrat." ], correct: 0 },
      { question: "Quelle est la couleur de l'eau iod√©e en pr√©sence d'amidon ?", options: [ "Jaune", "Bleue-violet.", "Rouge brique." ], correct: 1 },
      { question: "Quelle est la couleur qui appara√Æt en pr√©sence de protides lorsqu'on verse de l'acide nitrique sur un aliment ?", options: [ "Jaune", "Bleue-violet.", "Rouge brique." ], correct: 0 },
      { question: "Quelle est la couleur du pr√©cipit√© form√© lorsque le calcium r√©agit avec l'oxalate d'ammonium ?", options: [ "Blanche", "Jaune", "Rouge brique." ], correct: 0 },
      { question: "Quelle est la couleur du pr√©cipit√© form√© lorsque le sel de chlorure r√©agit avec le nitrate d'argent ?", options: [ "Blanche noircissant sous la lumi√®re", "Blanche ne noircissant pas sous la lumi√®re", "Rouge brique." ], correct: 0 }
    ];

    // === √âtat du quiz ===
    let questions = [];
    let answers = []; // tableau d'indices s√©lectionn√©s (null si non r√©pondu)
    let currentQuestionIndex = 0;

    // === Utilitaires ===
    function shuffle(array) {
      const a = [...array];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function initializeQuiz() {
      // M√©lange des questions ET des options, avec recalcul des indices justes
      questions = shuffle(originalQuestions).map(q => {
        const opt = shuffle(q.options.map((option, i) => ({ option, originalIndex: i })));
        const newCorrect = opt.findIndex(o => o.originalIndex === q.correct);
        return { question: q.question, options: opt.map(o => o.option), correct: newCorrect };
      });
      answers = Array.from({ length: questions.length }, () => null);
      currentQuestionIndex = 0;

      // Metadonn√©es UI
      document.getElementById('total-questions').textContent = questions.length;
      document.getElementById('score-total').textContent = questions.length;

      renderQuestion();
      updateProgress();
      updateScore();
      updateNavigationButtons();
      enableKeyboardNavigation();
    }

    function renderQuestion() {
      const container = document.getElementById('question-container');
      const q = questions[currentQuestionIndex];
      const selected = answers[currentQuestionIndex];

      container.classList.remove('active');
      container.innerHTML = `
        <div class="glass-effect rounded-3xl p-8 mb-6">
          <h2 class="text-2xl font-bold text-gray-800 mb-8 leading-relaxed">${q.question}</h2>
          <div class="space-y-4">
            ${q.options.map((option, idx) => `
              <button
                class="option-btn w-full text-left p-6 rounded-2xl border-2 border-blue-200 bg-blue-50 text-gray-800 hover:bg-blue-100 transition-all duration-300"
                id="option-${idx}"
                ${selected !== null ? 'data-disabled="true"' : ''}
                onclick="selectAnswer(${idx})"
              >
                <span class="inline-flex items-center justify-center w-10 h-10 bg-blue-500 text-white rounded-full text-lg font-bold mr-4">${String.fromCharCode(65 + idx)}</span>
                <span class="text-lg">${option}</span>
              </button>
            `).join('')}
          </div>
        </div>
      `;

      // Si question d√©j√† r√©pondue, figer l'√©tat visuel
      if (selected !== null) {
        lockOptionsAndReveal(selected, q.correct);
      }

      // animation d'entr√©e (fallback robuste)
      void container.offsetWidth; // force un reflow pour d√©clencher la transition
      container.classList.add('active');
    }

    function selectAnswer(selectedIndex) {
      // Emp√™cher une seconde r√©ponse
      if (answers[currentQuestionIndex] !== null) return;

      answers[currentQuestionIndex] = selectedIndex;
      const correct = questions[currentQuestionIndex].correct;

      lockOptionsAndReveal(selectedIndex, correct);
      updateScore();
      updateNavigationButtons();
    }

    function lockOptionsAndReveal(selectedIndex, correctIndex) {
      const q = questions[currentQuestionIndex];
      for (let i = 0; i < q.options.length; i++) {
        const btn = document.getElementById(`option-${i}`);
        if (!btn) continue;
        // D√©sactiver clics
        btn.style.pointerEvents = 'none';
        btn.setAttribute('aria-disabled', 'true');
      }
      const correctBtn = document.getElementById(`option-${correctIndex}`);
      if (correctBtn) correctBtn.classList.add('correct');
      if (selectedIndex !== correctIndex) {
        const selectedBtn = document.getElementById(`option-${selectedIndex}`);
        if (selectedBtn) selectedBtn.classList.add('incorrect');
      }
    }

    // === Navigation ===
    function nextQuestion() {
      if (currentQuestionIndex < questions.length - 1) {
        currentQuestionIndex++;
        renderQuestion();
        updateProgress();
        updateNavigationButtons();
      } else {
        showFinalResults();
      }
    }

    function previousQuestion() {
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        renderQuestion();
        updateProgress();
        updateNavigationButtons();
      }
    }

    function updateNavigationButtons() {
      const prevBtn = document.getElementById('prev-btn');
      const nextBtn = document.getElementById('next-btn');

      // Pr√©c√©dent
      prevBtn.disabled = currentQuestionIndex === 0;

      // Libell√© suivant
      nextBtn.textContent = (currentQuestionIndex === questions.length - 1) ? 'Terminer le quiz' : 'Suivant ‚Üí';
    }

    // === Progression & score ===
    function updateProgress() {
      const progressBar = document.getElementById('progress-bar');
      const currentQuestionElement = document.getElementById('current-question');
      const percentage = ((currentQuestionIndex + 1) / questions.length) * 100;
      progressBar.style.width = percentage + '%';
      currentQuestionElement.textContent = currentQuestionIndex + 1;
    }

    function updateScore() {
      const scoreEl = document.getElementById('score');
      const score = answers.reduce((acc, sel, i) => acc + (sel === questions[i].correct ? 1 : 0), 0);
      scoreEl.textContent = score;
    }

    // === R√©sultats finaux ===
    function showFinalResults() {
      const container = document.getElementById('question-container');
      const nav = document.getElementById('navigation');
      const results = document.getElementById('final-results');

      container.style.display = 'none';
      nav.classList.add('hidden');
      results.classList.remove('hidden');

      const total = questions.length;
      const score = answers.reduce((acc, sel, i) => acc + (sel === questions[i].correct ? 1 : 0), 0);
      const percentage = (score / total) * 100;

      let message, emoji;
      if (percentage >= 90) { message = `Excellent ! Vous ma√Ætrisez parfaitement les tests de reconnaissance des nutriments ! (${score}/${total})`; emoji = 'üèÜ'; }
      else if (percentage >= 70) { message = `Tr√®s bien ! Vous avez de bonnes connaissances en chimie alimentaire. (${score}/${total})`; emoji = 'üéâ'; }
      else if (percentage >= 50) { message = `Pas mal ! Continuez √† r√©viser les tests de reconnaissance. (${score}/${total})`; emoji = 'üëç'; }
      else { message = `Il faut r√©viser ! Reprenez les cours sur la composition chimique des aliments. (${score}/${total})`; emoji = 'üìö'; }

      document.getElementById('final-message').textContent = message;
      document.getElementById('final-emoji').textContent = emoji;
    }

    function resetQuiz() {
      // R√©-initialiser l'UI
      document.getElementById('final-results').classList.add('hidden');
      const qc = document.getElementById('question-container');
      qc.style.display = 'block';
      document.getElementById('navigation').classList.remove('hidden');
      initializeQuiz();
    }

    // === Navigation clavier ===
    function enableKeyboardNavigation() {
      // √âviter d'ajouter plusieurs √©couteurs
      window.removeEventListener('keydown', window.__quizKeyNav);
      window.__quizKeyNav = function(e) {
        if (e.key === 'ArrowRight') { e.preventDefault(); nextQuestion(); }
        if (e.key === 'ArrowLeft') { e.preventDefault(); previousQuestion(); }
      };
      window.addEventListener('keydown', window.__quizKeyNav);
    }

    // === Liaison des boutons ===
    document.getElementById('prev-btn').addEventListener('click', previousQuestion);
    document.getElementById('next-btn').addEventListener('click', nextQuestion);
    document.getElementById('reset-btn')?.addEventListener('click', resetQuiz);

    // D√©marrage ‚Äî afficher la question d√®s que le DOM est pr√™t (sans attendre le chargement des images)
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initializeQuiz);
} else {
  initializeQuiz();
}
  </script>
</body>
</html>
